<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>梦的博客 - 每天进步一点点</title><meta name="keywords" content="renmcc ren_mcc"><meta name="author" content="ren_mcc"><meta name="copyright" content="ren_mcc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:type" content="website">
<meta property="og:title" content="梦的博客">
<meta property="og:url" content="https://renm.cc/page/11/index.html">
<meta property="og:site_name" content="梦的博客">
<meta property="og:description" content="一个收藏回忆与分享技术的地方！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://renm.cc/img/avatar2.webp">
<meta property="article:author" content="ren_mcc">
<meta property="article:tag" content="renmcc ren_mcc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://renm.cc/img/avatar2.webp"><link rel="shortcut icon" href="/img/EPm3X74Wvr.png"><link rel="canonical" href="https://renm.cc/page/11/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":2000},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '梦的博客',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-03-02 12:24:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/twikoo-beautify.css"  media="defer" onload="this.media='all'"><script src="/live2d-widget/autoload.js"></script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="/js/function.min.css"><script src="/js/jquery.min.js"></script><script src="/js/custom.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script async src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar2.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">112</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">梦的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">梦的博客</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/20220111/docker-compose-20220111-5-%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E5%92%8C%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" title="5-命令补全和资源限制"><img class="post_bg" src="/img/yuanshen/avatar/1557a5d37ff148a9b9f2de02c4e43cdb.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5-命令补全和资源限制"></a></div><div class="recent-post-info"><a class="article-title" href="/20220111/docker-compose-20220111-5-%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E5%92%8C%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/" title="5-命令补全和资源限制">5-命令补全和资源限制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T15:06:27.000Z" title="发表于 2022-01-11 23:06:27">2022-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">1 命令补全
123curl -L -o /etc/bash_completion.d/docker-compose \    https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose # 下次登陆生效
2 资源限制
docker-compose v3版本命令,可以使用deploy来做资源限制,如:
12345image: flink:1.3.1deploy:  resources:    limits:      memory: 1G
但是docker-compose up命令不支持资源限制参数,提示如下:
1....Compose does not support &#x27;deploy&#x27; configuration - use `docker stack deploy` to deploy to a swarm
这个时候可以使用--compatibility参数
1--compatib ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-compose-20220110-4-compose-stack-swarm%E9%9B%86%E7%BE%A4/" title="4-compose/stack/swarm集群"><img class="post_bg" src="/img/yuanshen/avatar/63d9f2d3572c11df029f74b27ec300d9f503c2c7.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-compose/stack/swarm集群"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-4-compose-stack-swarm%E9%9B%86%E7%BE%A4/" title="4-compose/stack/swarm集群">4-compose/stack/swarm集群</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T11:56:19.000Z" title="发表于 2022-01-10 19:56:19">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">区别和联系
docker-compose V3之后,设置资源限额和容器数量的配置,只能写在deploy字段里, 但是docker-compose up  却不支持 deploy 配置
编辑同一份docker-compose.yml, 但是compose 和 swarm/stack的分工是这样的:

docker-compose   用于dev   支持build/restart  但是不支持deploy,
swarm/stack      用于 prod  支持 deply的各种设置,包括分配cpu和内存, 但是创建容器只支持从image,不支持build.

deploy扩缩容参数
deploy是用于在docker集群环境下自动进行扩容和缩容的配置项,docker-compose up and docker-compose run两个命令会忽略此配置,只有docker stack deploy命令下才有用
有以下子选项

endpoint_mode：集群对提供服务的方式

endpoint_mode: vip VIP方式
endpoint_mode: dnsrr dns轮询方式


 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-compose-20220110-3-docker-compose%E5%91%BD%E4%BB%A4/" title="3-docker-compose命令"><img class="post_bg" src="/img/yuanshen/avatar/20210501094041_fcc74.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-docker-compose命令"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-3-docker-compose%E5%91%BD%E4%BB%A4/" title="3-docker-compose命令">3-docker-compose命令</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T09:18:48.000Z" title="发表于 2022-01-10 17:18:48">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">1，Docker-compose命令格式
    docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]

命令选项如下
12345-f --file FILE指定Compose模板文件，默认为docker-compose.yml-p --project-name NAME 指定项目名称，默认使用当前所在目录为项目名--verbose  输出更多调试信息-v，-version 打印版本并退出--log-level LEVEL 定义日志等级(DEBUG, INFO, WARNING, ERROR, CRITICAL)
2，docker-compose up
docker-compose up [options] [--scale SERVICE=NUM...] [SERVICE...]

选项包括：
12345678910-d 在后台运行服务容器-no-color 不是有颜色来区分不同的服务的控制输出-no-deps 不启动服务所链接的容器--force-recreate 强制重新创建容器，不能与-no-recre ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-compose-20220110-2-compose%E5%91%BD%E4%BB%A4%E5%92%8Cyaml%E6%A8%A1%E6%9D%BF/" title="2-compose命令和yaml模板"><img class="post_bg" src="/img/yuanshen/avatar/128860_43586076260.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2-compose命令和yaml模板"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-2-compose%E5%91%BD%E4%BB%A4%E5%92%8Cyaml%E6%A8%A1%E6%9D%BF/" title="2-compose命令和yaml模板">2-compose命令和yaml模板</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T09:00:18.000Z" title="发表于 2022-01-10 17:00:18">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">一 compose命令和模板说明
A. compse命令列表说明
每个命令后后还有很多参数,具体的请用--help去查看



命令名
参数说明




build
构建项目中的服务容器


images
列出所有镜像


kill
通过发送SIGKILL信号来强制停止服务容器


logs
查看服务器容器的输出


pause
暂停一个服务容器


port
打印某个容器的端口所映射的公共端口


ps
列出项目中目前的所有容器


pull
拉取服务依赖的镜像


push
推送服务依赖的镜像


restart
重启项目中的服务


rm
删除所有的服务器容器（停止状态的）


run
在指定服务上执行一个命令


scale
设置指定服务运行的容器个数


start
启动已经存在的服务容器


stop
停止已经处于运行状态的容器，但不删除它


top
展示运行的进程


unpause
恢复处于暂停状态中的服务


up
自动完成包括构建镜像、创建服务、启动服务并关联服务相关容器的一系列操作



B. Compose模板文件的说明

compose模板文件官方文档
co ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-compose-20220110-1-docker-compose%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="1-docker-compose快速入门"><img class="post_bg" src="/img/yuanshen/avatar/80cb39dbb6fd52664b98c08fbdfcf522d60736e3.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1-docker-compose快速入门"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-compose-20220110-1-docker-compose%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="1-docker-compose快速入门">1-docker-compose快速入门</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T03:19:56.000Z" title="发表于 2022-01-10 11:19:56">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker-compose/">docker-compose</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker-compose/">docker-compose</a></span></div><div class="content">一 docker-compose的简介
docker-compose是dokcer官方的单机编排工具，让用户通过编写一个简单的模板文件，快速地创建和管理基于docker容器的应用集群。实现对docker容器集群的快速编排。
允许用户通过一个单独的docker-compose.yml模板文件（YAML格式）来定义一组相关联的应用容器作为一个项目（project）
A. Compose2个重要概念：

服务（service）
一个应用的容器，实际上可以包含若干运行相同镜像的容器实例。
项目（project）
由一组关联的应用容器组成的一个完整业务单元，在docker-compose.yml文件中定义。

B. 使用Compose的三步骤：

Dockerfile 定义应用的运行环境
docker-compose.yml 定义组成应用的各服务
docker-compose up 启动整个应用

C. docker-compose命令与模板文件

docker-compose命令
对于Compose来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或容器。默认针对项目

1234 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-20220110-7-docker%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" title="7-docker容器的网络通信"><img class="post_bg" src="/img/yuanshen/avatar/18d8bc3eb13533fac24510ce24edd01640345b22.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7-docker容器的网络通信"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-20220110-7-docker%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" title="7-docker容器的网络通信">7-docker容器的网络通信</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T03:00:35.000Z" title="发表于 2022-01-10 11:00:35">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">一 容器网络的类型
Docker 网络从覆盖范围可分为单个 host 上的容器网络和跨多个 host 的网络,多host网络又分为原生网络和第三方网络,如下:

原生单机网络

None：不为容器配置任何网络功能,–net=none
Host：与主机共享Network Namespace,–net=host
Container：与另一个运行中的容器共享网络名称空间,–net=container:ID
Bridge：Docker设计的,默认的NAT网络模型,–net=bridge


原生多机网络

overlay：基于vxlan的隧道网络
macvlan：基于网卡虚拟化的大局域网


第三方多机网络[本章不讨论]

flannel
weave
calico




原生网络和单机网络都是通过不同的driver来实现的,未来可能还会有更多的开源driver

二 原生单机网络
docker安装好后,默认会创建三个网络,分别是none,host和bridge,用docker network ls命令查看如下
12345[root@docker01 ~]# docker network ls ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-20220110-6-docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%92%8C%E6%A0%87%E7%AD%BEtag/" title="6-docker镜像仓库和标签tag"><img class="post_bg" src="/img/yuanshen/avatar/20210501094038_14f7d.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="6-docker镜像仓库和标签tag"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-20220110-6-docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%92%8C%E6%A0%87%E7%AD%BEtag/" title="6-docker镜像仓库和标签tag">6-docker镜像仓库和标签tag</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T02:44:15.000Z" title="发表于 2022-01-10 10:44:15">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">一 docker仓库和镜像tag
A. docker仓库分类
docker镜像是需要放到一个统一的仓库的,以便不同的主机可以下载和使用相同的镜像而不必每次都用dockerfile自己做,docker镜像仓库按如下方式划分

公共仓库

官方公共仓库

docker hub


第三方公共仓库

阿里云
七牛云
DaoCloud
时速云




私有仓库

官方命令行仓库:registry
第三方web仓库:harbor



B. docker镜像tag命名规范
在基础知识部分,介绍了标准镜像名由四部分组成: 仓库地址/项目名/镜像名:标签,如 daocloud.io/library/nginx:latest
一个高效的版本命名方案可以让用户清楚地知道当前使用的是哪个镜像，同时还可以保持足够的灵活性。
每个镜像可以有多个 tag，而多个 tag 可能对应的是同一个镜像。下面介绍 Docker 社区普遍使用的 tag 方案。

初始版本v1.9.1
镜像名为myimage，当前需要的版本为 v1.9.1。那么可以给镜像打上四个 tag：1、1.9、1.9.1和 latest。

1234 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-20220110-5-docker%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/" title="5-docker镜像构建"><img class="post_bg" src="/img/yuanshen/avatar/6d6b36c8dca7430b8429929ff6c3b71d!400x400.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5-docker镜像构建"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-20220110-5-docker%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/" title="5-docker镜像构建">5-docker镜像构建</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T02:07:21.000Z" title="发表于 2022-01-10 10:07:21">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">一 docker镜像构建说明
A. 两种构建方式

手动构建docker镜像
自动构建docker镜像[dockerfile]

B. 构建步骤

手工构建步骤

启动容器安装软件服务
将安装好服务的容器commit提交为镜像
启动新容器来测试新提交的镜像


自动构建步骤

编写dockerfile文件
通过build命令使用该dockerfile构建镜像
启动新容器来测试新提交的镜像



C. dockerfile命令集



指令
功能
特殊说明




FROM
指定基础镜像
必须有


MAINTAINER
指定维护者信息
可以没有


ENV
设置环境变量
可被后面的指令使用


COPY
复制文件到容器



ADD
复制文件到容器
压缩文件会自动解压


WORKDIR
设置当前工作目录
类似linux的cd命令


VOLUME
设置卷，挂载主机目录
需’-v’配合


EXPOSE
指定对外的端口
默认不暴露,需&quot;-P&quot;配合


RUN
运行指定的命令
在用于容器创建过程中执行命令


CMD
容器启动后执行的命令
容易被替换


ENTRYP ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/20220110/docker-20220110-4-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%85%B1%E4%BA%AB%E4%BA%92%E8%BF%9E/" title="4-数据的持久化和共享互连"><img class="post_bg" src="/img/yuanshen/avatar/94bc574f61b24190986210faabe51831.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-数据的持久化和共享互连"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-20220110-4-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%85%B1%E4%BA%AB%E4%BA%92%E8%BF%9E/" title="4-数据的持久化和共享互连">4-数据的持久化和共享互连</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T01:39:30.000Z" title="发表于 2022-01-10 09:39:30">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">一 容器数据持久化和共享方案
A.为什么要使用docker数据持久化
正常情况下，删除容器，容器中所有的文件也会被删除。所以需要能持久化容器中数据的方法,也就是数据卷
数据卷(Data Volume)的作用：

持久化容器运行过程中产生的数据文件
实现多个容器间的文件共享。
实现多个主机间有状态容器的迁移

B.docker数据卷的分类
在集群环境下,数据卷分为:

单机内容器间的数据持久化和共享

数据卷[Data Volume]

绑定挂载[bind mount]
容器管理卷[docker managed volume]


容器卷[volume container]


跨主机容器间的数据持久化和共享

使用分布式文件系统(如NFS)
使用volume driver实现跨主机存储

Rex-Ray插件
更多官方插件





C.容器间互连的方式
容器互联大体有以下三种方式：

基于volume的互联
基于link的互联
基于网络的互联


其中基于网络的互连会在网络部分单独写,基于volume的互连和基于link的互连会在本节详细说明

二 数据卷的使用详情
数据卷[Data  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/20220110/docker-20220110-3-docker%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/" title="3-docker基础操作命令"><img class="post_bg" src="/img/yuanshen/avatar/d52a2834349b033ba9c9636899f01bdad439bd83.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-docker基础操作命令"></a></div><div class="recent-post-info"><a class="article-title" href="/20220110/docker-20220110-3-docker%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/" title="3-docker基础操作命令">3-docker基础操作命令</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-10T01:12:50.000Z" title="发表于 2022-01-10 09:12:50">2022-01-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-20T10:32:21.000Z" title="更新于 2022-02-20 18:32:21">2022-02-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/docker/">docker</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/docker/">docker</a></span></div><div class="content">一 命令格式
docker的命令分老版命令格式和新版命令格式,新版命令主要是更直观了,添加了镜像[image]和容器[container]来区分命令,简单举例对比:
1.显示容器命令
老版命令:docker ps
新版命令:docker container ls
2.显示镜像命令
老版命令: docker images
新版命令: docker image ls
3.删除镜像命令
老版命令: docker rmi centos:latest
新版命令: docker image rm centos:latest
二 镜像相关命令
1.搜索镜像：
docker search xxx
选镜像的建议：优先考虑官方镜像,然后是starts数量多的镜像
2.拉取/推送镜像:
1.拉取镜像到本地
docker image pull centos
2.推送centos镜像到仓库
docker image push centos
3. 镜像加速器
在/etc/docker/daemon.json文件中写上仓库和地址,详见docker部署章节
4. 查看/删除镜像
1.查看镜像
docker image ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/10/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/#content-inner">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/#content-inner">12</a><a class="extend next" rel="next" href="/page/12/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar2.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ren_mcc</div><div class="author-info__description">一个收藏回忆与分享技术的地方！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">112</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/renmcc"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/20230301/golang-20230301-GRPC/" title="GRPC"><img src="/img/yuanshen/avatar/5366d0160924ab18a1113d3fa6c4cbc47b890b7e.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GRPC"/></a><div class="content"><a class="title" href="/20230301/golang-20230301-GRPC/" title="GRPC">GRPC</a><time datetime="2023-02-28T16:14:12.000Z" title="发表于 2023-03-01 00:14:12">2023-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230227/golang-20230227-Protobuf%E7%BC%96%E8%A7%A3%E7%A0%81/" title="Protobuf编解码"><img src="/img/yuanshen/avatar/8812956h7p1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Protobuf编解码"/></a><div class="content"><a class="title" href="/20230227/golang-20230227-Protobuf%E7%BC%96%E8%A7%A3%E7%A0%81/" title="Protobuf编解码">Protobuf编解码</a><time datetime="2023-02-27T15:25:30.000Z" title="发表于 2023-02-27 23:25:30">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230219/golang-20230219-go%E8%AF%AD%E8%A8%80RPC/" title="go语言RPC"><img src="/img/yuanshen/avatar/1f178a82b9014a904ee6e31f2649141bb21bee04.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go语言RPC"/></a><div class="content"><a class="title" href="/20230219/golang-20230219-go%E8%AF%AD%E8%A8%80RPC/" title="go语言RPC">go语言RPC</a><time datetime="2023-02-19T10:06:21.000Z" title="发表于 2023-02-19 18:06:21">2023-02-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230211/golang-20230211-golang%E5%91%BD%E4%BB%A4%E8%A1%8C/" title="golang命令行"><img src="/img/yuanshen/avatar/10006.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang命令行"/></a><div class="content"><a class="title" href="/20230211/golang-20230211-golang%E5%91%BD%E4%BB%A4%E8%A1%8C/" title="golang命令行">golang命令行</a><time datetime="2023-02-11T15:35:25.000Z" title="发表于 2023-02-11 23:35:25">2023-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20230129/golang-20230129-golang%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/" title="golang数据库编程"><img src="/img/yuanshen/avatar/d1a20cf431adcbef7f6fa3648c4b4cd4a2cc9f62.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang数据库编程"/></a><div class="content"><a class="title" href="/20230129/golang-20230129-golang%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/" title="golang数据库编程">golang数据库编程</a><time datetime="2023-01-29T07:23:53.000Z" title="发表于 2023-01-29 15:23:53">2023-01-29</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/containerd/"><span class="card-category-list-name">containerd</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker/"><span class="card-category-list-name">docker</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/docker-compose/"><span class="card-category-list-name">docker-compose</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/git/"><span class="card-category-list-name">git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/golang/"><span class="card-category-list-name">golang</span><span class="card-category-list-count">38</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/istio/"><span class="card-category-list-name">istio</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kafka/"><span class="card-category-list-name">kafka</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kubernetes/"><span class="card-category-list-name">kubernetes</span><span class="card-category-list-count">27</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/containerd/" style="font-size: 1.32em; color: rgb(80, 190, 36)">containerd</a><a href="/tags/docker/" style="font-size: 1.38em; color: rgb(77, 122, 136)">docker</a><a href="/tags/docker-compose/" style="font-size: 1.28em; color: rgb(193, 143, 53)">docker-compose</a><a href="/tags/git/" style="font-size: 1.15em; color: rgb(37, 167, 101)">git</a><a href="/tags/istio/" style="font-size: 1.38em; color: rgb(169, 44, 67)">istio</a><a href="/tags/kubernetes/" style="font-size: 1.42em; color: rgb(179, 58, 31)">kubernetes</a><a href="/tags/kubrnetes/" style="font-size: 1.35em; color: rgb(106, 35, 22)">kubrnetes</a><a href="/tags/golang/" style="font-size: 1.45em; color: rgb(175, 29, 53)">golang</a><a href="/tags/kafka/" style="font-size: 1.18em; color: rgb(135, 121, 95)">kafka</a><a href="/tags/kvm/" style="font-size: 1.25em; color: rgb(110, 33, 103)">kvm</a><a href="/tags/nginx/" style="font-size: 1.15em; color: rgb(82, 58, 48)">nginx</a><a href="/tags/python/" style="font-size: 1.22em; color: rgb(97, 40, 36)">python</a><a href="/tags/rancher/" style="font-size: 1.22em; color: rgb(10, 138, 200)">rancher</a><a href="/tags/redis/" style="font-size: 1.18em; color: rgb(79, 4, 23)">redis</a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.15em; color: rgb(91, 5, 94)">工具</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.22em; color: rgb(73, 137, 68)">大数据</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><span class="card-archive-list-count">25</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><span class="card-archive-list-count">25</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">112</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2021-12-06T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">198.9k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-03-02T04:24:12.936Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By ren_mcc</div><div class="footer_custom_text"><a rel="noopener external nofollow noreferrer noopener" target="_blank" href="https://beian.miit.gov.cn/"> <img class="icp-icon entered loading" alt="ICP" src="/img/icp.png" data-ll-status><span>京ICP备2022001205号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = []
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: false,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><div class="aplayer no-destroy" data-id="7211977673" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="list" data-preload="none" data-autoplay="false" muted></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>